# TanLabs固件框架

本目录为运行在CPU上的软件的框架（固件框架）。

## 框架编译

与《计算机组成原理》实验中的监控程序类似，实验者在编译本框架前，需要下载并解压安装好RISC-V工具链以及QEMU模拟器。此外，还需要将工具链以及QEMU的路径加入`PATH`环境变量中。工具链同样可以选择SiFive提供的版本。

基于此，实验者在此目录运行`make`即可编译本框架并产生`kernel.bin`文件。将其写入实验板的SRAM中即可使得CPU执行。需要注意的是，此处建议实验者将《计算机组成原理》实验中的CPU指令集扩充为完整的RV32I，方便后续使用高级语言进行软件开发以及系统集成。

此外，可以使用的`make`命令还包括如下几个：

* `make sim`：运行QEMU模拟执行。
* `make debug`：运行QEMU模拟执行，执行前暂停模拟器，等待调试器命令。实验者可以运行GDB（`riscv64-unknown-elf-gdb`）并先后执行`set arch riscv:rv32`、`tar rem :1234`来连接模拟器，然后进行调试。
* `make viasm`：使用`vi`打开编译生成的可执行文件的反汇编代码，可用于调试。
* `make inst`：统计编译生成的可执行文件中用到的指令，方便实验者与CPU协同设计。

## 文件说明

* `reset_vector.S`：CPU上电后执行的首条指令在此文件中，其通过后文所述的链接器脚本被固定在`0x80000000`地址处。
* `main.c`：主函数在此文件中，其首先初始化BSS段（这是必要的），然后初始化串口并输出一行`hello, world`。**实验者需要修改此文件来添加所需功能。**
* `uart.c`：UART串口驱动程序。
* `printf.c`：`printf`函数实现，基于上述串口。
* `include`：框架的include目录，所有头文件存放于此处。
* `linker.ld`：链接器脚本，指定链接产生可执行文件的内存布局，以及程序入口点。
* `Makefile`：Makefile。
* `inst.py`：用于统计指令的脚本。
* **此外，实验者还需要加入转发表及网络软硬件接口的驱动程序，以及RIP路由协议软件实现等。**

